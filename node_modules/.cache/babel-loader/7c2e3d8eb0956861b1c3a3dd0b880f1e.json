{"ast":null,"code":"import { Top, Bottom, Left, Right } from '../constants';\nimport { set, tempBounds } from './util';\nimport { boundStroke, multiLineOffset } from 'vega-scenegraph';\nexport function isYAxis(mark) {\n  var orient = mark.items[0].datum.orient;\n  return orient === Left || orient === Right;\n}\n\nfunction axisIndices(datum) {\n  var index = +datum.grid;\n  return [datum.ticks ? index++ : -1, // ticks index\n  datum.labels ? index++ : -1, // labels index\n  index + +datum.domain // title index\n  ];\n}\n\nexport function axisLayout(view, axis, width, height) {\n  var item = axis.items[0],\n      datum = item.datum,\n      orient = datum.orient,\n      delta = datum.translate != null ? datum.translate : 0.5,\n      indices = axisIndices(datum),\n      range = item.range,\n      offset = item.offset,\n      position = item.position,\n      minExtent = item.minExtent,\n      maxExtent = item.maxExtent,\n      title = datum.title && item.items[indices[2]].items[0],\n      titlePadding = item.titlePadding,\n      bounds = item.bounds,\n      dl = title && multiLineOffset(title),\n      x = 0,\n      y = 0,\n      i,\n      s;\n  tempBounds.clear().union(bounds);\n  bounds.clear();\n  if ((i = indices[0]) > -1) bounds.union(item.items[i].bounds);\n  if ((i = indices[1]) > -1) bounds.union(item.items[i].bounds); // position axis group and title\n\n  switch (orient) {\n    case Top:\n      x = position || 0;\n      y = -offset;\n      s = Math.max(minExtent, Math.min(maxExtent, -bounds.y1));\n      if (title) s = axisTitleLayout(view, title, s, titlePadding, dl, 0, -1, bounds);\n      bounds.add(0, -s).add(range, 0);\n      break;\n\n    case Left:\n      x = -offset;\n      y = position || 0;\n      s = Math.max(minExtent, Math.min(maxExtent, -bounds.x1));\n      if (title) s = axisTitleLayout(view, title, s, titlePadding, dl, 1, -1, bounds);\n      bounds.add(-s, 0).add(0, range);\n      break;\n\n    case Right:\n      x = width + offset;\n      y = position || 0;\n      s = Math.max(minExtent, Math.min(maxExtent, bounds.x2));\n      if (title) s = axisTitleLayout(view, title, s, titlePadding, dl, 1, 1, bounds);\n      bounds.add(0, 0).add(s, range);\n      break;\n\n    case Bottom:\n      x = position || 0;\n      y = height + offset;\n      s = Math.max(minExtent, Math.min(maxExtent, bounds.y2));\n      if (title) s = axisTitleLayout(view, title, s, titlePadding, 0, 0, 1, bounds);\n      bounds.add(0, 0).add(range, s);\n      break;\n\n    default:\n      x = item.x;\n      y = item.y;\n  } // update bounds\n\n\n  boundStroke(bounds.translate(x, y), item);\n\n  if (set(item, 'x', x + delta) | set(item, 'y', y + delta)) {\n    item.bounds = tempBounds;\n    view.dirty(item);\n    item.bounds = bounds;\n    view.dirty(item);\n  }\n\n  return item.mark.bounds.clear().union(bounds);\n}\n\nfunction axisTitleLayout(view, title, offset, pad, dl, isYAxis, sign, bounds) {\n  var b = title.bounds,\n      dx = 0,\n      dy = 0;\n\n  if (title.auto) {\n    view.dirty(title);\n    offset += pad;\n    isYAxis ? dx = (title.x || 0) - (title.x = sign * (offset + dl)) : dy = (title.y || 0) - (title.y = sign * (offset + dl));\n    title.mark.bounds.clear().union(b.translate(-dx, -dy));\n    view.dirty(title);\n\n    if (isYAxis) {\n      bounds.add(0, b.y1).add(0, b.y2);\n      offset += b.width();\n    } else {\n      bounds.add(b.x1, 0).add(b.x2, 0);\n      offset += b.height();\n    }\n  } else {\n    bounds.union(b);\n  }\n\n  return offset;\n}","map":null,"metadata":{},"sourceType":"module"}