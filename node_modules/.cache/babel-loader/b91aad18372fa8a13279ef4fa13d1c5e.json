{"ast":null,"code":"import parseEncode from '../encode';\nimport { FrameRole, MarkRole } from '../marks/roles';\nimport { array, extend, hasOwnProperty, isArray, isObject } from 'vega-util';\nexport function encoder(_) {\n  return isObject(_) && !isArray(_) ? extend({}, _) : {\n    value: _\n  };\n}\nexport function addEncode(object, name, value, set) {\n  if (value != null) {\n    if (isObject(value) && !isArray(value)) {\n      object.update[name] = value;\n    } else {\n      object[set || 'enter'][name] = {\n        value: value\n      };\n    }\n\n    return 1;\n  } else {\n    return 0;\n  }\n}\nexport function addEncoders(object, enter, update) {\n  for (var name in enter) {\n    addEncode(object, name, enter[name]);\n  }\n\n  for (var _name in update) {\n    addEncode(object, _name, update[_name], 'update');\n  }\n}\nexport function extendEncode(encode, extra, skip) {\n  for (var name in extra) {\n    if (skip && hasOwnProperty(skip, name)) continue;\n    encode[name] = extend(encode[name] || {}, extra[name]);\n  }\n\n  return encode;\n}\nexport function encoders(encode, type, role, style, scope, params) {\n  var enc, key;\n  params = params || {};\n  params.encoders = {\n    $encode: enc = {}\n  };\n  encode = applyDefaults(encode, type, role, style, scope.config);\n\n  for (key in encode) {\n    enc[key] = parseEncode(encode[key], type, params, scope);\n  }\n\n  return params;\n}\n\nfunction applyDefaults(encode, type, role, style, config) {\n  var defaults = {},\n      enter = {},\n      update,\n      key,\n      skip,\n      props; // ignore legend and axis\n\n  if (role == 'legend' || String(role).indexOf('axis') === 0) {\n    role = null;\n  } // resolve mark config\n\n\n  props = role === FrameRole ? config.group : role === MarkRole ? extend({}, config.mark, config[type]) : null;\n\n  for (key in props) {\n    // do not apply defaults if relevant fields are defined\n    skip = has(key, encode) || (key === 'fill' || key === 'stroke') && (has('fill', encode) || has('stroke', encode));\n    if (!skip) applyDefault(defaults, key, props[key]);\n  } // resolve styles, apply with increasing precedence\n\n\n  array(style).forEach(function (name) {\n    var props = config.style && config.style[name];\n\n    for (var key in props) {\n      if (!has(key, encode)) {\n        applyDefault(defaults, key, props[key]);\n      }\n    }\n  });\n  encode = extend({}, encode); // defensive copy\n\n  for (key in defaults) {\n    props = defaults[key];\n\n    if (props.signal) {\n      (update = update || {})[key] = props;\n    } else {\n      enter[key] = props;\n    }\n  }\n\n  encode.enter = extend(enter, encode.enter);\n  if (update) encode.update = extend(update, encode.update);\n  return encode;\n}\n\nfunction applyDefault(defaults, key, value) {\n  defaults[key] = value && value.signal ? {\n    signal: value.signal\n  } : {\n    value: value\n  };\n}\n\nexport function has(key, encode) {\n  return encode && (encode.enter && encode.enter[key] || encode.update && encode.update[key]);\n}","map":null,"metadata":{},"sourceType":"module"}