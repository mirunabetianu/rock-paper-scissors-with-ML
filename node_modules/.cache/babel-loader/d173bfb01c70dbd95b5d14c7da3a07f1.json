{"ast":null,"code":"import { isObject } from 'vega-util';\nexport function Entry(type, value, params, parent) {\n  this.id = -1;\n  this.type = type;\n  this.value = value;\n  this.params = params;\n  if (parent) this.parent = parent;\n}\nexport function entry(type, value, params, parent) {\n  return new Entry(type, value, params, parent);\n}\nexport function operator(value, params) {\n  return entry('operator', value, params);\n} // -----\n\nexport function ref(op) {\n  var ref = {\n    $ref: op.id\n  }; // if operator not yet registered, cache ref to resolve later\n\n  if (op.id < 0) (op.refs = op.refs || []).push(ref);\n  return ref;\n}\nexport var tupleidRef = {\n  $tupleid: 1,\n  toString: function toString() {\n    return ':_tupleid_:';\n  }\n};\nexport function fieldRef(field, name) {\n  return name ? {\n    $field: field,\n    $name: name\n  } : {\n    $field: field\n  };\n}\nexport var keyFieldRef = fieldRef('key');\nexport function compareRef(fields, orders) {\n  return {\n    $compare: fields,\n    $order: orders\n  };\n}\nexport function keyRef(fields, flat) {\n  var ref = {\n    $key: fields\n  };\n  if (flat) ref.$flat = true;\n  return ref;\n} // -----\n\nexport var Ascending = 'ascending';\nexport var Descending = 'descending';\nexport function sortKey(sort) {\n  return !isObject(sort) ? '' : (sort.order === Descending ? '-' : '+') + aggrField(sort.op, sort.field);\n}\nexport function aggrField(op, field) {\n  return (op && op.signal ? '$' + op.signal : op || '') + (op && field ? '_' : '') + (field && field.signal ? '$' + field.signal : field || '');\n} // -----\n\nexport var Scope = 'scope';\nexport var View = 'view';\nexport function isSignal(_) {\n  return _ && _.signal;\n}\nexport function isExpr(_) {\n  return _ && _.expr;\n}\nexport function hasSignal(_) {\n  if (isSignal(_)) return true;\n  if (isObject(_)) for (var key in _) {\n    if (hasSignal(_[key])) return true;\n  }\n  return false;\n}\nexport function value(specValue, defaultValue) {\n  return specValue != null ? specValue : defaultValue;\n}\nexport function deref(v) {\n  return v && v.signal || v;\n}","map":null,"metadata":{},"sourceType":"module"}