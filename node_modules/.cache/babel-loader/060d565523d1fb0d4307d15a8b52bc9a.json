{"ast":null,"code":"import { array8, array16, array32 } from './arrays';\n/**\n * Maintains CrossFilter state.\n */\n\nexport default function Bitmaps() {\n  var width = 8,\n      _data = [],\n      _seen = array32(0),\n      _curr = array(0, width),\n      _prev = array(0, width);\n\n  return {\n    data: function data() {\n      return _data;\n    },\n    seen: function seen() {\n      return _seen = lengthen(_seen, _data.length);\n    },\n    add: function add(array) {\n      for (var i = 0, j = _data.length, n = array.length, t; i < n; ++i) {\n        t = array[i];\n        t._index = j++;\n\n        _data.push(t);\n      }\n    },\n    remove: function remove(num, map) {\n      // map: index -> boolean (true => remove)\n      var n = _data.length,\n          copy = Array(n - num),\n          reindex = _data,\n          // reuse old data array for index map\n      t,\n          i,\n          j; // seek forward to first removal\n\n      for (i = 0; !map[i] && i < n; ++i) {\n        copy[i] = _data[i];\n        reindex[i] = i;\n      } // condense arrays\n\n\n      for (j = i; i < n; ++i) {\n        t = _data[i];\n\n        if (!map[i]) {\n          reindex[i] = j;\n          _curr[j] = _curr[i];\n          _prev[j] = _prev[i];\n          copy[j] = t;\n          t._index = j++;\n        } else {\n          reindex[i] = -1;\n        }\n\n        _curr[i] = 0; // clear unused bits\n      }\n\n      _data = copy;\n      return reindex;\n    },\n    size: function size() {\n      return _data.length;\n    },\n    curr: function curr() {\n      return _curr;\n    },\n    prev: function prev() {\n      return _prev;\n    },\n    reset: function reset(k) {\n      _prev[k] = _curr[k];\n    },\n    all: function all() {\n      return width < 0x101 ? 0xff : width < 0x10001 ? 0xffff : 0xffffffff;\n    },\n    set: function set(k, one) {\n      _curr[k] |= one;\n    },\n    clear: function clear(k, one) {\n      _curr[k] &= ~one;\n    },\n    resize: function resize(n, m) {\n      var k = _curr.length;\n\n      if (n > k || m > width) {\n        width = Math.max(m, width);\n        _curr = array(n, width, _curr);\n        _prev = array(n, width);\n      }\n    }\n  };\n}\n\nfunction lengthen(array, length, copy) {\n  if (array.length >= length) return array;\n  copy = copy || new array.constructor(length);\n  copy.set(array);\n  return copy;\n}\n\nfunction array(n, m, array) {\n  var copy = (m < 0x101 ? array8 : m < 0x10001 ? array16 : array32)(n);\n  if (array) copy.set(array);\n  return copy;\n}","map":null,"metadata":{},"sourceType":"module"}