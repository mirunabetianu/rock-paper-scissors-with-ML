{"ast":null,"code":"import { Transform } from 'vega-dataflow';\nimport { getProjectionPath } from 'vega-projection';\nimport { inherits, identity } from 'vega-util';\n/**\n * Map GeoJSON data to an SVG path string.\n * @constructor\n * @param {object} params - The parameters for this operator.\n * @param {function(number, number): *} params.projection - The cartographic\n *   projection to apply.\n * @param {function(object): *} [params.field] - The field with GeoJSON data,\n *   or null if the tuple itself is a GeoJSON feature.\n * @param {string} [params.as='path'] - The output field in which to store\n *   the generated path data (default 'path').\n */\n\nexport default function GeoPath(params) {\n  Transform.call(this, null, params);\n}\nGeoPath.Definition = {\n  \"type\": \"GeoPath\",\n  \"metadata\": {\n    \"modifies\": true\n  },\n  \"params\": [{\n    \"name\": \"projection\",\n    \"type\": \"projection\"\n  }, {\n    \"name\": \"field\",\n    \"type\": \"field\"\n  }, {\n    \"name\": \"pointRadius\",\n    \"type\": \"number\",\n    \"expr\": true\n  }, {\n    \"name\": \"as\",\n    \"type\": \"string\",\n    \"default\": \"path\"\n  }]\n};\nvar prototype = inherits(GeoPath, Transform);\n\nprototype.transform = function (_, pulse) {\n  var out = pulse.fork(pulse.ALL),\n      path = this.value,\n      field = _.field || identity,\n      as = _.as || 'path',\n      flag = out.SOURCE;\n\n  function set(t) {\n    t[as] = path(field(t));\n  }\n\n  if (!path || _.modified()) {\n    // parameters updated, reset and reflow\n    this.value = path = getProjectionPath(_.projection);\n    out.materialize().reflow();\n  } else {\n    flag = field === identity || pulse.modified(field.fields) ? out.ADD_MOD : out.ADD;\n  }\n\n  var prev = initPath(path, _.pointRadius);\n  out.visit(flag, set);\n  path.pointRadius(prev);\n  return out.modifies(as);\n};\n\nfunction initPath(path, pointRadius) {\n  var prev = path.pointRadius();\n  path.context(null);\n\n  if (pointRadius != null) {\n    path.pointRadius(pointRadius);\n  }\n\n  return prev;\n}","map":null,"metadata":{},"sourceType":"module"}