{"ast":null,"code":"import { Transform } from 'vega-dataflow';\nimport { fastmap, inherits } from 'vega-util';\n/**\n * An index that maps from unique, string-coerced, field values to tuples.\n * Assumes that the field serves as a unique key with no duplicate values.\n * @constructor\n * @param {object} params - The parameters for this operator.\n * @param {function(object): *} params.field - The field accessor to index.\n */\n\nexport default function TupleIndex(params) {\n  Transform.call(this, fastmap(), params);\n}\nvar prototype = inherits(TupleIndex, Transform);\n\nprototype.transform = function (_, pulse) {\n  var df = pulse.dataflow,\n      field = _.field,\n      index = this.value,\n      mod = true;\n\n  function set(t) {\n    index.set(field(t), t);\n  }\n\n  if (_.modified('field') || pulse.modified(field.fields)) {\n    index.clear();\n    pulse.visit(pulse.SOURCE, set);\n  } else if (pulse.changed()) {\n    pulse.visit(pulse.REM, function (t) {\n      index.delete(field(t));\n    });\n    pulse.visit(pulse.ADD, set);\n  } else {\n    mod = false;\n  }\n\n  this.modified(mod);\n  if (index.empty > df.cleanThreshold) df.runAfter(index.clean);\n  return pulse.fork();\n};","map":null,"metadata":{},"sourceType":"module"}