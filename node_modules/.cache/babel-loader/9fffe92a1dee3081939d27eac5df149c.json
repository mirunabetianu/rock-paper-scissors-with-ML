{"ast":null,"code":"import { Transform } from 'vega-dataflow';\nimport { inherits } from 'vega-util';\nvar COUNTER_NAME = ':vega_identifier:';\n/**\n * Adds a unique identifier to all added tuples.\n * This transform creates a new signal that serves as an id counter.\n * As a result, the id counter is shared across all instances of this\n * transform, generating unique ids across multiple data streams. In\n * addition, this signal value can be included in a snapshot of the\n * dataflow state, enabling correct resumption of id allocation.\n * @constructor\n * @param {object} params - The parameters for this operator.\n * @param {string} params.as - The field name for the generated identifier.\n */\n\nexport default function Identifier(params) {\n  Transform.call(this, 0, params);\n}\nIdentifier.Definition = {\n  \"type\": \"Identifier\",\n  \"metadata\": {\n    \"modifies\": true\n  },\n  \"params\": [{\n    \"name\": \"as\",\n    \"type\": \"string\",\n    \"required\": true\n  }]\n};\nvar prototype = inherits(Identifier, Transform);\n\nprototype.transform = function (_, pulse) {\n  var counter = getCounter(pulse.dataflow),\n      id = counter.value,\n      as = _.as;\n  pulse.visit(pulse.ADD, function (t) {\n    if (!t[as]) t[as] = ++id;\n  });\n  counter.set(this.value = id);\n  return pulse;\n};\n\nfunction getCounter(view) {\n  var counter = view._signals[COUNTER_NAME];\n\n  if (!counter) {\n    view._signals[COUNTER_NAME] = counter = view.add(0);\n  }\n\n  return counter;\n}","map":null,"metadata":{},"sourceType":"module"}