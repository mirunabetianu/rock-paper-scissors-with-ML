{"ast":null,"code":"import { image } from 'vega-canvas';\nimport { loader } from 'vega-loader';\nexport default function ResourceLoader(customLoader) {\n  this._pending = 0;\n  this._loader = customLoader || loader();\n}\nvar prototype = ResourceLoader.prototype;\n\nprototype.pending = function () {\n  return this._pending;\n};\n\nfunction increment(loader) {\n  loader._pending += 1;\n}\n\nfunction decrement(loader) {\n  loader._pending -= 1;\n}\n\nprototype.sanitizeURL = function (uri) {\n  var loader = this;\n  increment(loader);\n  return loader._loader.sanitize(uri, {\n    context: 'href'\n  }).then(function (opt) {\n    decrement(loader);\n    return opt;\n  }).catch(function () {\n    decrement(loader);\n    return null;\n  });\n};\n\nprototype.loadImage = function (uri) {\n  var loader = this,\n      Image = image();\n  increment(loader);\n  return loader._loader.sanitize(uri, {\n    context: 'image'\n  }).then(function (opt) {\n    var url = opt.href;\n    if (!url || !Image) throw {\n      url: url\n    };\n    var img = new Image();\n\n    img.onload = function () {\n      decrement(loader);\n    };\n\n    img.onerror = function () {\n      decrement(loader);\n    };\n\n    img.src = url;\n    return img;\n  }).catch(function (e) {\n    decrement(loader);\n    return {\n      complete: false,\n      width: 0,\n      height: 0,\n      src: e && e.url || ''\n    };\n  });\n};\n\nprototype.ready = function () {\n  var loader = this;\n  return new Promise(function (accept) {\n    function poll(value) {\n      if (!loader.pending()) accept(value);else setTimeout(function () {\n        poll(true);\n      }, 10);\n    }\n\n    poll(false);\n  });\n};","map":null,"metadata":{},"sourceType":"module"}